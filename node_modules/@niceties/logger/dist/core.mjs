import { globalAppender } from './global-appender.mjs';

let globalInputId = 0;
const getOptions = (options) => {
    var _a, _b;
    let parentId, tag;
    if (options.length === 1) {
        if (typeof options[0] === 'string') {
            tag = options[0];
        }
        else {
            parentId = (_a = options[0]) === null || _a === void 0 ? void 0 : _a.id;
        }
    }
    else if (options.length === 2) {
        tag = options[0];
        parentId = (_b = options[1]) === null || _b === void 0 ? void 0 : _b.id;
    }
    return { parentId, tag };
};
const createLogger = (...args) => {
    let initialLogLevel = 1 /* info */;
    let myAppender = (message) => { globalAppender && globalAppender(message); };
    const inputId = globalInputId++;
    const { tag, parentId } = getOptions(args);
    const append = (message, action, loglevel, context) => {
        myAppender && myAppender({
            action,
            inputId,
            message,
            loglevel,
            tag,
            parentId,
            ref,
            context
        });
    };
    const loggerInstance = Object.assign((message, loglevel = 1 /* info */, context) => {
        append(message, 3 /* log */, loglevel, context);
    }, {
        // Fine to be started multiple times
        start(message, loglevel, context) {
            if (loglevel !== undefined) {
                initialLogLevel = loglevel;
            }
            append(message, 0 /* start */, initialLogLevel, context);
        },
        // Fine to be updated multiple times
        update(message, loglevel, context) {
            append(message, 1 /* update */, loglevel !== null && loglevel !== void 0 ? loglevel : initialLogLevel, context);
        },
        // Fine to be finished multiple times
        finish(message, loglevel, context) {
            append(message, 2 /* finish */, loglevel !== null && loglevel !== void 0 ? loglevel : initialLogLevel, context);
        },
        appender(appender) {
            if (appender !== undefined) {
                myAppender = appender;
            }
            return myAppender;
        }
    });
    Object.defineProperty(loggerInstance, 'id', {
        value: inputId,
        writable: false
    });
    const ref = new WeakRef(loggerInstance);
    return loggerInstance;
};

export { createLogger };
